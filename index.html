<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Faster Browser Code</title>
		<link type="text/css" href="styles.css" media="screen" rel="Stylesheet" />
		<script type="text/javascript" src="tests/js_webworker/benchmark.js"></script>
		<script type="text/javascript" src="tests/js_webworker_use_strict/benchmark.js"></script>
		<script type="text/javascript" src="tests/js_webworker_or_integers/benchmark.js"></script>
		<script type="text/javascript" src="tests/emscripten_c/benchmark.js"></script>
		<script type="text/javascript" src="tests/emscripten_c_o3/benchmark.js"></script>
		<style>
		table, th, td {
		   border: 1px solid black;
		}
		</style>
	</head>
	<body>
		<span id="forkongithub">
			<a href="https://github.com/SoftwareAddictionShow/faster-browser-code">Fork me on GitHub</a>
		</span>

		<h1>Faster Browser Code</h1>

		<p>
			This application benchmarks different web technologies. The goal
			is to see which is faster than vanilla JavaScript. The function
			fibonacci(43) is run in each benchmark.
		</p>

		<p>
			FIXME: When you click the button, it is not obvious what is happening. Add a spinner
			in its place.
		</p>

		<h2>Benchmarks:</h2>
		<p>
			<button id="start">Start Benchmarks</button>
		</p>

		<table>
			<tr>
				<th>Technology</th>
				<th>Description</th>
				<th>Time</th>
			</tr>
			<tr>
				<td>JavaScript - WebWorker</td>
				<td>JavaScript running in a WebWorker.</td>
				<td><span id="time_js_webworker"></span></td>
			</tr>
			<tr>
				<td>JavaScript - WebWorker Use Strict</td>
				<td>JavaScript using the "use strict" directive.</td>
				<td><span id="time_js_webworker_use_strict"></span></td>
			</tr>
			<tr>
				<td>JavaScript - WebWorker Or Integers</td>
				<td>JavaScript using bit manipulation ( 3 | 0) to let the
					browser know the variable will be used as an integer
					instead of a float.</td>
				<td><span id="time_js_webworker_or_integers"></span></td>
			</tr>
			<tr>
				<td>Emscripten - C</td>
				<td>C compiled with Emscripten on default settings.</td>
				<td><span id="time_emscripten_c"></span></td>
			</tr>
			<tr>
				<td>Emscripten - C with -O3</td>
				<td>C compiled with Emscripten on optimized(-O3) settings.</td>
				<td><span id="time_emscripten_c_o3"></span></td>
			</tr>
		</table>

		<h2>TODO:</h2>
		<ul>
			<li>Emscripten - C with Closure Compiler</li>
			<li>Emscripten - C++</li>
			<li>JavaScript - SIMD</li>
			<li>ASM.js</li>
			<li>Duetto</li>
			<li>WebAssembly - C++</li>
			<li>Dart</li>
			<li>TypeScript</li>
			<li>CoffeeScript</li>
			<li>Nacl</li>
			<li>Pnacl</li>
			<li>Hax</li>
			<li>GLSL</li>
			<li>C# - JSIL</li>
			<li>Go - gopherjs</li>
			<li>OpenCL</li>
			<li>WebCL</li>
		</ul>
	</body>
	<script>
	var g_benchmarks = [
		{'time_js_webworker' : benchmarkJSWebWorker},
		{'time_js_webworker_use_strict' : benchmarkJSWebWorkerUseStrict},
		{'time_js_webworker_or_integers' : benchmarkJSWebWorkerUseOrIntegers},
		{'time_emscripten_c' : benchmarkEmscriptenC},
		{'time_emscripten_c_o3' : benchmarkEmscriptenCO3}
	];

	function startBenchmarks() {
		var nextBenchmark = function(i) {
			if (i >= g_benchmarks.length) {
				document.querySelector('#start').style.display = '';
				return;
			}

			var bench_element = Object.keys(g_benchmarks[i])[0];
			var bench_cb = g_benchmarks[i][bench_element];
			var time_span = document.querySelector('#' + bench_element);
			time_span.innerHTML = 'Running ...';

			setTimeout(function() {
				bench_cb(function(diff_time, result) {
					time_span.innerHTML = diff_time + 'ms';
					nextBenchmark(i + 1);
				});
			}, 100);
		};
		nextBenchmark(0);
	}

	document.querySelector('#start').addEventListener('click', function() {
		document.querySelector('#start').style.display = 'none';
		startBenchmarks();
	}, false);
	</script>
</html>
